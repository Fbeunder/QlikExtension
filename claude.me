# QlikExtension - Live Treinen Volgen

## 1. Projectoverzicht
Dit project betreft een Qlik Sense extensie waarmee gebruikers real-time treinen kunnen volgen in een dashboard. De extensie maakt gebruik van externe API's om treinlocaties op te halen en weer te geven, en kan gefilterd worden op basis van treinnummers die in de Qlik Sense applicatie aanwezig zijn.

## 2. Architectuur
De extensie volgt de standaard Qlik Sense extensie structuur:

```
LiveTrainExtension/
├── LiveTrainExtension.js         # Hoofdmodule voor de extensie
├── LiveTrainExtension.qext       # Qlik extensie metadata bestand
├── initialProperties.js          # Initiële eigenschappen configuratie
├── propertyPanel.js              # Configuratie van het eigenschappen paneel
├── api/
│   ├── trainDataService.js       # Service voor het ophalen van treingegevens
│   └── apiConfig.js              # API configuratie en endpoints
├── ui/
│   ├── mapRenderer.js            # Verantwoordelijk voor het weergeven van de kaart
│   └── trainVisualizer.js        # Functionaliteit voor het visualiseren van treinen op de kaart
└── lib/                          # Externe bibliotheken
    ├── css/
    │   └── style.css             # Stylesheet voor de extensie
    └── js/
        └── qlik-style.js         # Hulpprogramma voor integratie met Qlik stijlen
```

## 3. Modules

### 3.1 LiveTrainExtension.js
* **Status**: Voltooid - Geïntegreerd met trainDataService, selectiemogelijkheden, mapRenderer, trainVisualizer, en dynamische updates. Bug in configureAnimationSettings opgelost.
* **Bestandsnaam**: LiveTrainExtension.js
* **Functionaliteit**: Hoofdmodule die de extensie initialiseert en integreert met Qlik Sense
* **Belangrijkste functies**:
  * `paint(element, layout)`: 
    * Parameters: 
      * element (HTMLElement): DOM element waar de visualisatie in geplaatst wordt
      * layout (Object): Layout configuratie van Qlik Sense
    * Return waarde: Belofte die wordt opgelost wanneer het tekenen is voltooid
    * Afhankelijkheden: trainDataService.js, apiConfig.js, mapRenderer.js, trainVisualizer.js
  * `initMap($element, layout)`: 
    * Parameters: 
      * $element (jQuery): jQuery element met de extensie
      * layout (Object): Layout object met configuratie
    * Return waarde: Geen
    * Afhankelijkheden: mapRenderer.js
  * `configureAnimationSettings(layout)`: 
    * Parameters: 
      * layout (Object): Layout object met configuratie
    * Return waarde: Geen
    * Afhankelijkheden: trainVisualizer.js
  * `updateTrainVisualization(trainData, selectedTrainIds, layout)`:
    * Parameters:
      * trainData (Array): Array met treingegevens
      * selectedTrainIds (Array): Array met geselecteerde treinnummers
      * layout (Object): Layout object met configuratie
    * Return waarde: Geen
    * Afhankelijkheden: mapRenderer.js, trainVisualizer.js
  * `refreshTrainData(trainNumbers, $element)`: 
    * Parameters: 
      * trainNumbers (Array): Lijst met treinnummers om te filteren
      * $element (jQuery): jQuery element om te updaten
    * Return waarde: Geen
    * Afhankelijkheden: trainDataService.js
  * `controller()`: 
    * Parameters: Geen
    * Return waarde: Controller object
    * Afhankelijkheden: trainDataService.js, apiConfig.js, mapRenderer.js, trainVisualizer.js
  * `getSelectedTrainNumbers(layout)`: 
    * Parameters: 
      * layout (Object): Layout object met hypercube data
    * Return waarde: Array met geselecteerde treinnummers
    * Afhankelijkheden: Geen
  * `selectTrain(trainId, multiSelect)`: 
    * Parameters: 
      * trainId (String): Treinnummer om te selecteren
      * multiSelect (Boolean): Of meerdere selecties toegestaan zijn
    * Return waarde: Geen
    * Afhankelijkheden: Qlik API
  * `clearSelections()`: 
    * Parameters: Geen
    * Return waarde: Geen
    * Afhankelijkheden: Qlik API

### 3.2 LiveTrainExtension.qext
* **Status**: Voltooid
* **Bestandsnaam**: LiveTrainExtension.qext
* **Functionaliteit**: Metadata bestand voor de extensie
* **Belangrijkste functies**: N.v.t. (JSON configuratiebestand)

### 3.3 initialProperties.js
* **Status**: Voltooid - Uitgebreid met standaardwaarden voor dynamische updates
* **Bestandsnaam**: initialProperties.js
* **Functionaliteit**: Definieert de initiële eigenschappen van de extensie
* **Belangrijkste functies**: N.v.t. (exporteert alleen een configuratie object)

### 3.4 propertyPanel.js
* **Status**: Voltooid - Uitgebreid met configuratie-opties voor dynamische updates en animatie
* **Bestandsnaam**: propertyPanel.js
* **Functionaliteit**: Definieert het eigenschappen paneel voor de extensie
* **Belangrijkste functies**:
  * `getDefinition()`: 
    * Parameters: Geen
    * Return waarde: Eigenschappen paneel definitie object
    * Afhankelijkheden: Geen

### 3.5 trainDataService.js
* **Status**: Voltooid - Bijgewerkt voor integratie met NS-API en ReferenceError opgelost in startAutoRefresh
* **Bestandsnaam**: api/trainDataService.js
* **Functionaliteit**: Service voor het ophalen van treingegevens van externe API's
* **Belangrijkste functies**:
  * `getTrainLocations(trainNumbers)`: 
    * Parameters: 
      * trainNumbers (Array): Lijst met treinnummers om te filteren
    * Return waarde: Belofte met treinlocatie gegevens
    * Afhankelijkheden: apiConfig.js
  * `startAutoRefresh(callback, intervalSeconds)`: 
    * Parameters: 
      * callback (Function): Functie die wordt aangeroepen bij elke update
      * intervalSeconds (number): Verversingsinterval in seconden
    * Return waarde: Geen
    * Afhankelijkheden: apiConfig.js
  * `stopAutoRefresh()`: 
    * Parameters: Geen
    * Return waarde: Geen
    * Afhankelijkheden: Geen
  * `transformAPIResponse(response)`: 
    * Parameters: 
      * response (Object): API respons object
    * Return waarde: Array met getransformeerde treinlocaties
    * Afhankelijkheden: apiConfig.js
  * `filterByTrainNumbers(response, trainNumbers)`:
    * Parameters:
      * response (Object): De originele API respons
      * trainNumbers (Array): Array met treinnummers om te filteren
    * Return waarde: Gefilterde respons object
    * Afhankelijkheden: Geen
  * `calculateDelayInMinutes(trainData)`:
    * Parameters:
      * trainData (Object): Treingegevens uit de API
    * Return waarde: Number met de vertraging in minuten
    * Afhankelijkheden: Geen